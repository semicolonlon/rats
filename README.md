## プロジェクト概要

ようこそ、本リポジトリへ。
ここでは、リアルタイム位置情報を駆使して校内を探し回りながら楽しむ“人狼ゲーム”風ウェブアプリを開発しています。
バックエンドは Node.js ＋ SQLite3、フロントエンドは MapLibre GL。歩き回ってミッションをクリアしたり、メッセージで仲間を煽ったりできます。

ちょっとした探偵気分で校舎を駆け回り、見つかった時の言い訳を考えるのが一番の見どころです。

## 主な機能

- **ユーザー登録・認証**
  デバイス ID で一人ひとりをガッチリ管理（名前は自由ですが嘘はバレる）。
- **位置＆向き情報の送信**
  緯度・経度はもちろん、端末の向きまでキャッチ。ピザを探す口実にも使えます。
- **ランダムミッション生成**
  `missions.json` からミッションをランダムピック。何度やっても「あれ、これ前やった？」が楽しみ。
- **タスク管理**
  ミッションの追加・一覧取得・完了マーク。達成感を味わうはずが、つい忘れてクリア済みにしてしまう罠。
- **メッセージ機能**
  半径内のプレイヤーだけに送るこっそりチャット。タイミング悪いと自分だけミュートされます。
- **WebSocket 連携（予定）**
  双方向リアルタイム通信で、もっとアツい駆け引きをお楽しみに。実装は脳内会議中。

## 必要環境

- Node.js v20.x 以上
- npm または yarn
- SQLite3

## セットアップ手順

1. リポジトリをクローン

   ```bash
   git clone <リポジトリURL>
   cd <リポジトリディレクトリ>
   ```

2. 依存パッケージをインストール

   ```bash
   npm install
   # または
   yarn install
   ```

3. 設定ファイルを確認・編集

   - **config.json**

     ```json
     {
       "port": 3000,
       "playerThreshold": 5
     }
     ```

   - **missions.json**

     ```json
     {
       "missions": [
         {
           "missionName": "屋台の揚げパンを探せ",
           "position": { "lat": 35.123484, "lng": 139.123361 }
         }
         // 他にもこだわりのミッションをどんどん追加
       ]
     }
     ```

4. サーバーを起動

   ```bash
   npm start
   ```

   ブラウザで `http://localhost:3000` を開くと、あなたの冒険が始まります。

## データベースについて

プロジェクト直下に `game.db` を自動生成。
起動時に必要なテーブルを自動作成します。
マイグレーションが必要なら、別途 SQL スクリプトを実行してください。

## API エンドポイント例

| メソッド | パス                        | 説明                     |
| -------- | --------------------------- | ------------------------ |
| POST     | `/api/users/register`       | 新規ユーザー登録         |
| GET      | `/api/users`                | 全ユーザー一覧取得       |
| POST     | `/api/users/updatePosition` | 位置情報(lat, lng)更新   |
| POST     | `/api/users/updateAngle`    | 向き情報(angle)更新      |
| GET      | `/api/tasks?userId={id}`    | ユーザーのタスク一覧取得 |
| POST     | `/api/tasks/add`            | タスク追加               |
| POST     | `/api/messages/send`        | 半径内メッセージ送信     |
| GET      | `/api/messages/{deviceId}`  | デバイス宛メッセージ取得 |

※実装に合わせてパスやパラメータはご自由に変更ください。テスト用に `curl` する時は気をつけて。

## フロントエンド

`public/index.html` から起動。
MapLibre GL で地図をレンダリングし、ピンやプレイヤーアイコンをスタイリッシュにプロット。
定期的に位置と向き情報をサーバーに送信します。

## 今後の拡張予定

- WebSocket による本気のリアルタイム通信
- UI/UX をさらに洗練
- タスク完了時のドヤ顔アニメーション

## コントリビューション歓迎

バグ報告もプルリクも大歓迎。Issue や PR をお待ちしています。

## ライセンス

MIT License
